{"version":2,"kind":"Article","sha256":"b591149930a5d74c484e8b9d5cef19162dc1abf796e29ba198ecd05ee9e96be9","slug":"kubernetes","location":"/kubernetes.md","dependencies":[],"frontmatter":{"title":"Kubernetes Guide","github":"https://github.com/esgf2-us/esgf2-us.github.io","keywords":[],"numbering":{"title":{"offset":1}},"edit_url":"https://github.com/esgf2-us/esgf2-us.github.io/blob/new-Architecture/kubernetes.md","exports":[{"format":"md","filename":"kubernetes.md","url":"/kubernetes-38197be5465d0b3450272e091f2ad58c.md"}]},"mdast":{"type":"root","children":[{"type":"block","children":[{"type":"heading","depth":2,"position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"children":[{"type":"text","value":"Deploy ESGF using Kubernetes","position":{"start":{"line":5,"column":1},"end":{"line":5,"column":1}},"key":"u7FZFnCWLk"}],"identifier":"deploy-esgf-using-kubernetes","label":"Deploy ESGF using Kubernetes","html_id":"deploy-esgf-using-kubernetes","implicit":true,"key":"M7eUFpUurS"},{"type":"paragraph","position":{"start":{"line":7,"column":1},"end":{"line":8,"column":1}},"children":[{"type":"text","value":"This project provides a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"BWVvexVCA8"},{"type":"link","url":"https://helm.sh/docs/topics/charts/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Helm chart","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"gEmJjZXBGO"}],"urlSource":"https://helm.sh/docs/topics/charts/","key":"T5SYkt4aA7"},{"type":"text","value":" to deploy ESGF resources\non a ","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"AyjcJzeAKb"},{"type":"link","url":"https://kubernetes.io/","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"children":[{"type":"text","value":"Kubernetes","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"Fo3LEccdEq"}],"urlSource":"https://kubernetes.io/","key":"umDr0w6eYp"},{"type":"text","value":" cluster.","position":{"start":{"line":7,"column":1},"end":{"line":7,"column":1}},"key":"L02R6X8ZCC"}],"key":"gjfkPsb1uv"},{"type":"paragraph","position":{"start":{"line":10,"column":1},"end":{"line":11,"column":1}},"children":[{"type":"text","value":"The chart is in ","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"BUc9S0rvyA"},{"type":"link","url":"../../deploy/kubernetes/chart/","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"children":[{"type":"text","value":"deploy​/kubernetes​/chart","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"TMvFcb8QL9"}],"urlSource":"../../deploy/kubernetes/chart/","key":"MiIWuD4ZgD"},{"type":"text","value":". Please look at the\nfiles to understand exactly what resources are being created.","position":{"start":{"line":10,"column":1},"end":{"line":10,"column":1}},"key":"L7CthfwWUz"}],"key":"yXX3yg7H5h"},{"type":"paragraph","position":{"start":{"line":13,"column":1},"end":{"line":16,"column":1}},"children":[{"type":"text","value":"For a complete list of all the variables that are available, please look at the\n","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"ThUcA7drVV"},{"type":"link","url":"../../deploy/kubernetes/chart/values.yaml","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"children":[{"type":"text","value":"values.yaml for the chart","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"i948xqNVl7"}],"urlSource":"../../deploy/kubernetes/chart/values.yaml","key":"Kpca878kgq"},{"type":"text","value":". The defaults there have\nextensive comments that explain how to use these variables. This documentation describes how to\napply some common configurations.","position":{"start":{"line":13,"column":1},"end":{"line":13,"column":1}},"key":"zyVRzHUe9y"}],"key":"Q4qxFpv3BD"},{"type":"comment","value":" TOC depthFrom:2 ","key":"u8QcRqsaLl"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":20,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"link","url":"#installingupgrading-esgf","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"children":[{"type":"text","value":"Installing/upgrading ESGF","position":{"start":{"line":20,"column":1},"end":{"line":20,"column":1}},"key":"kBWpc4aO9w"}],"urlSource":"#installingupgrading-esgf","key":"Td76NPP6yv"}],"key":"vkxX3XTAWJ"},{"type":"listItem","spread":true,"position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"children":[{"type":"text","value":"Local test installation with Minikube","position":{"start":{"line":21,"column":1},"end":{"line":21,"column":1}},"key":"a5NpAT6sPf"}],"identifier":"local-test-installation-with-minikube","label":"local-test-installation-with-minikube","kind":"heading","template":"{name}","resolved":true,"html_id":"local-test-installation-with-minikube","key":"Fb0RjB5EFS"}],"key":"VOcDBwq6NH"},{"type":"listItem","spread":true,"position":{"start":{"line":22,"column":1},"end":{"line":23,"column":1}},"children":[{"type":"crossReference","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"children":[{"type":"text","value":"Configuring the installation","position":{"start":{"line":22,"column":1},"end":{"line":22,"column":1}},"key":"Cmjkp6RIM5"}],"identifier":"configuring-the-installation","label":"configuring-the-installation","kind":"heading","template":"{name}","resolved":true,"html_id":"configuring-the-installation","key":"RCKwVrITag"}],"key":"H8A9jv8K1e"}],"key":"BzQrTLR3X6"},{"type":"comment","value":" /TOC ","key":"RsVJvxTLqq"},{"type":"heading","depth":3,"position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"children":[{"type":"text","value":"Installing/upgrading ESGF","position":{"start":{"line":26,"column":1},"end":{"line":26,"column":1}},"key":"ReNwvmPHh7"}],"identifier":"installing-upgrading-esgf","label":"Installing/upgrading ESGF","html_id":"installing-upgrading-esgf","implicit":true,"key":"WImn7lx4Xo"},{"type":"paragraph","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"children":[{"type":"text","value":"Before attempting to install the ESGF Helm chart, you must have the following:","position":{"start":{"line":28,"column":1},"end":{"line":28,"column":1}},"key":"Ss39oNqTEk"}],"key":"SWZFUNmBg5"},{"type":"list","ordered":false,"spread":false,"position":{"start":{"line":30,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"listItem","spread":true,"position":{"start":{"line":30,"column":1},"end":{"line":31,"column":1}},"children":[{"type":"text","value":"A Kubernetes cluster with an\n","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"fzXwcVQhn6"},{"type":"link","url":"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"children":[{"type":"text","value":"Ingress Controller","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"AiSzwYa6PX"}],"urlSource":"https://kubernetes.io/docs/concepts/services-networking/ingress-controllers/","key":"j5uf4JzHJW"},{"type":"text","value":" enabled","position":{"start":{"line":30,"column":1},"end":{"line":30,"column":1}},"key":"w8ArJqYHin"}],"key":"dnn8yTVfS8"},{"type":"listItem","spread":true,"position":{"start":{"line":32,"column":1},"end":{"line":33,"column":1}},"children":[{"type":"link","url":"https://kubernetes.io/docs/tasks/tools/install-kubectl/","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"children":[{"type":"text","value":"kubectl","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"aXAvXgrH6Q"}],"urlSource":"https://kubernetes.io/docs/tasks/tools/install-kubectl/","key":"S91Wgt1Zzu"},{"type":"text","value":" installed and configured to talk\nto your cluster","position":{"start":{"line":32,"column":1},"end":{"line":32,"column":1}},"key":"Dp9LwQyxr3"}],"key":"B7MNQhiQYi"},{"type":"listItem","spread":true,"position":{"start":{"line":34,"column":1},"end":{"line":35,"column":1}},"children":[{"type":"link","url":"https://helm.sh/docs/intro/install/","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"children":[{"type":"text","value":"Helm","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"plTpDFy8yS"}],"urlSource":"https://helm.sh/docs/intro/install/","key":"nT4oJr7puv"},{"type":"text","value":" installed","position":{"start":{"line":34,"column":1},"end":{"line":34,"column":1}},"key":"ZdA8SIZDqO"}],"key":"r2Z35hN0jv"}],"key":"mlui19elX6"},{"type":"paragraph","position":{"start":{"line":36,"column":1},"end":{"line":39,"column":1}},"children":[{"type":"text","value":"Next, make a configuration directory - this can be anywhere on your machine that is ","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"B1L0sfzWAd"},{"type":"strong","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"children":[{"type":"text","value":"not","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"RJkJIv0qkv"}],"key":"MkuXA0wwna"},{"type":"text","value":" under\n","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"PKMwjujJQH"},{"type":"inlineCode","value":"esgf-docker","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"KCHSSdnNZP"},{"type":"text","value":". You can also place this directory under version control if you wish - this can be very\nuseful for tracking changes to the configuration, or even triggering deployments automatically when\nconfiguration changes.","position":{"start":{"line":36,"column":1},"end":{"line":36,"column":1}},"key":"FLw0j7bMtF"}],"key":"zBqeTWHU1S"},{"type":"paragraph","position":{"start":{"line":41,"column":1},"end":{"line":43,"column":1}},"children":[{"type":"text","value":"In your configuration directory, make a new YAML file called ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"FBkgv3drkO"},{"type":"inlineCode","value":"values.yaml","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"pCV049uNtN"},{"type":"text","value":" and override any variables to fit\nyour deployment. The only required variable is ","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"hku00lbebc"},{"type":"inlineCode","value":"hostname","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"ErAVpdw11j"},{"type":"text","value":", which should be the DNS name at which your\nESGF deployment will be available:","position":{"start":{"line":41,"column":1},"end":{"line":41,"column":1}},"key":"VCyOsEBq2O"}],"key":"aORS6lTiwU"},{"type":"code","lang":"yaml","value":"hostname: esgf.example.org","position":{"start":{"line":45,"column":1},"end":{"line":47,"column":1}},"key":"YTVMfV0kul"},{"type":"admonition","position":{"start":{"line":49,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"admonitionTitle","children":[{"type":"text","value":"Note","key":"y2oV3j49td"}],"key":"tpFj06HeKG"},{"type":"paragraph","position":{"start":{"line":49,"column":1},"end":{"line":49,"column":1}},"children":[],"key":"ecdjw5MwqK"},{"type":"paragraph","position":{"start":{"line":51,"column":1},"end":{"line":52,"column":1}},"children":[{"type":"text","value":"The Helm chart does not create a DNS entry for the hostname. This must be separately configured\nto point to the ingress controller for your Kubernetes cluster.","position":{"start":{"line":51,"column":1},"end":{"line":51,"column":1}},"key":"bE5ngeAW8u"}],"key":"ORgoFipe10"}],"kind":"note","class":"simple","key":"t5kNVYaXLa"},{"type":"paragraph","position":{"start":{"line":54,"column":1},"end":{"line":55,"column":1}},"children":[{"type":"text","value":"Once you have configured your ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"LUk1YxRyfp"},{"type":"inlineCode","value":"values.yaml","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"DTAYgweSGw"},{"type":"text","value":", you can install or upgrade ESGF using the Helm chart. If no\nnamespace is specified, it will use the default namespace for your ","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"XqTfkLiHuw"},{"type":"inlineCode","value":"kubectl","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"TJSOAb4v3i"},{"type":"text","value":" configuration:","position":{"start":{"line":54,"column":1},"end":{"line":54,"column":1}},"key":"QYXK9DyJzv"}],"key":"JBTpg1qiyZ"},{"type":"code","lang":"sh","value":"helm upgrade -i [-n <namespace>] -f /my/esgf/config/values.yaml --wait esgf ./deploy/kubernetes/chart","position":{"start":{"line":57,"column":1},"end":{"line":59,"column":1}},"key":"dSS7k3Egj9"},{"type":"heading","depth":3,"position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"children":[{"type":"text","value":"Local test installation with Minikube","position":{"start":{"line":61,"column":1},"end":{"line":61,"column":1}},"key":"m6SEZMRTiq"}],"identifier":"local-test-installation-with-minikube","label":"Local test installation with Minikube","html_id":"local-test-installation-with-minikube","implicit":true,"key":"RcxTY8cHSZ"},{"type":"paragraph","position":{"start":{"line":63,"column":1},"end":{"line":64,"column":1}},"children":[{"type":"text","value":"For local test deployments, you can use ","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"NIp5BcwhET"},{"type":"link","url":"https://kubernetes.io/docs/setup/learning-environment/minikube/","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"Minikube","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"qOsXfNJEz4"}],"urlSource":"https://kubernetes.io/docs/setup/learning-environment/minikube/","key":"zTSEfOT44p"},{"type":"text","value":"\nwith data from ","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"cWHSy9YJvp"},{"type":"link","url":"https://github.com/roocs/mini-esgf-data","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"children":[{"type":"text","value":"roocs​/mini​-esgf​-data","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"SFuVXm3mba"}],"urlSource":"https://github.com/roocs/mini-esgf-data","error":true,"key":"DgMYywSbsJ"},{"type":"text","value":":","position":{"start":{"line":63,"column":1},"end":{"line":63,"column":1}},"key":"hwswgF2Um8"}],"key":"rHGEW2zTDO"},{"type":"code","lang":"sh","value":"# Start the minikube cluster\nminikube start\n# Enable the ingress addon\nminikube addons enable ingress\n# Install the test data\nminikube ssh \"curl -fsSL https://github.com/roocs/mini-esgf-data/tarball/master | sudo tar -xz --strip-components=1 -C / --wildcards */test_data\"","position":{"start":{"line":66,"column":1},"end":{"line":73,"column":1}},"key":"jmZJwFZMOp"},{"type":"paragraph","position":{"start":{"line":75,"column":1},"end":{"line":77,"column":1}},"children":[{"type":"text","value":"Configure the chart to serve the test data (see\n","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"CWbiT1PRA2"},{"type":"link","url":"../../deploy/kubernetes/minikube-values.yaml","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"children":[{"type":"text","value":"minikube​-values​.yaml","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"IX1BZ34gRS"}],"urlSource":"../../deploy/kubernetes/minikube-values.yaml","key":"AgMyaqZdNJ"},{"type":"text","value":"), using a ","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"XuKK9edGR2"},{"type":"inlineCode","value":"nip.io","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"ogtQSl30ii"},{"type":"text","value":"\ndomain pointing to the Minikube server:","position":{"start":{"line":75,"column":1},"end":{"line":75,"column":1}},"key":"xF44oCN5qj"}],"key":"vNtvJUgDcK"},{"type":"code","lang":"sh","value":"helm install esgf ./deploy/kubernetes/chart/ \\\n  -f ./deploy/kubernetes/minikube-values.yaml \\\n  --set hostname=\"$(minikube ip).nip.io\"","position":{"start":{"line":79,"column":1},"end":{"line":83,"column":1}},"key":"uQ3S2Ti2Oa"},{"type":"paragraph","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"children":[{"type":"text","value":"Once the containers have started, the THREDDS interface will be available at ","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"mHJ3vEkVM4"},{"type":"inlineCode","value":"http://$(minikube ip).nip.io/thredds","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"AVmBRojqie"},{"type":"text","value":".","position":{"start":{"line":85,"column":1},"end":{"line":85,"column":1}},"key":"pjxAwAsxdh"}],"key":"oFNgoFMlOI"},{"type":"heading","depth":3,"position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"children":[{"type":"text","value":"Configuring the installation","position":{"start":{"line":87,"column":1},"end":{"line":87,"column":1}},"key":"kIhDSdAUUt"}],"identifier":"configuring-the-installation","label":"Configuring the installation","html_id":"configuring-the-installation","implicit":true,"key":"VbS0IGE17F"},{"type":"paragraph","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"See ","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"Ve8onFU7qG"},{"type":"link","url":"./configure.md","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"children":[{"type":"text","value":"Configuring a Kubernetes deployment","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"AWstkLNxaL"}],"urlSource":"./configure.md","key":"ucRZYXm6Au"},{"type":"text","value":".","position":{"start":{"line":89,"column":1},"end":{"line":89,"column":1}},"key":"Ml4ija6qUX"}],"key":"VXzjj2rJHF"}],"key":"Dc3ixQxugm"}],"key":"gESyTsK8x6"},"references":{"cite":{"order":[],"data":{}}}}